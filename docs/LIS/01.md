# 智慧城市空间信息服务平台时空数据建库

## 1. 数据库概述

本文档是基于T/ZSA 44—2020《智慧城市空间信息服务平台时空数据建库规范》制定的数据库设计文档。本文档旨在规范智慧城市空间信息服务平台时空数据建库过程，以保证时空数据质量和可用性。

本文档适用于智慧城市空间信息服务平台时空数据库建设。本文档包括以下内容：

- 数据库逻辑设计
- 数据库物理设计
- 数据库安全设计
- 数据库测试设计

## 2. 数据库逻辑设计

本部分给出了智慧城市空间信息服务平台时空数据建库规范所涉及到的实体关系图（E-R图），并对各个实体和关系进行了说明。



### 2.1 元数据（Metadata）

元数据是描述时空数据基本属性和特征的实体，包括以下属性：

- id：元数据唯一标识符
- name：元数据名称
- type：元数据类型
- source：元数据来源
- time_range：元数据时间范围
- space_range：元数据空间范围

### 2.2 实体（Entity）

实体是记录时空对象具体属性和状态的实体，包括以下属性：

- id：实体唯一标识符
- metadata_id：实体所属元数据标识符
- location：实体位置
- shape：实体形状
- size：实体大小
- color：实体颜色
- speed：实体速度

### 2.3 关系（Relation）

关系是描述时空对象之间相互作用和影响的实体，包括以下属性：

- id：关系唯一标识符
- entity1_id：关系涉及到的第一个实体标识符
- entity2_id: 关系涉及到的第二个实体标识符
- relation_type: 关系类型

### 2.4 事件（Event）

事件是记录时空对象发生变化和动态的实体，包括以下属性：

-id: 事件唯一标识符 
-entity_id: 事件涉及到的实体标识符 
-event_type: 事件类型 
-event_time: 事件发生时间 

## 3. 数据库物理设计

本部分给出了智慧城市空间信息服务平台时空数据建库规范所涉及到的表结构图，并对各个表和字段进行了说明。



### 3.1 元数据表（Metadata）

元数据表存储时空数据的元数据信息，包括以下字段：

- id：INT类型，主键，非空，自增，表示元数据唯一标识符
- name：VARCHAR(50)类型，非空，表示元数据名称
- type：VARCHAR(50)类型，非空，表示元数据类型
- source：VARCHAR(50)类型，非空，表示元数据来源
- time_range：DATETIME类型，非空，表示元数据时间范围
- space_range：GEOMETRY类型，非空，表示元数据空间范围

### 3.2 实体表（Entity）

实体表存储时空对象的实体信息，包括以下字段：

- id：INT类型，主键，非空，自增，表示实体唯一标识符
- metadata_id：INT类型，外键引用Metadata(id)，非空，表示实体所属元数据标识符
- location：GEOMETRY类型，非空，表示实体位置
- shape：GEOMETRY类型, 非空, 表示实体形状 -size: FLOAT 类型, 非空, 表示实体大小 -color: VARCHAR(20) 类型, 非空, 表示实体颜色 -speed: FLOAT 类型, 非空, 表示实体速度

### 3.3 关系表（Relation）

关系表存储时空对象之间的关系信息，包括以下字段：

- id：INT类型，主键，非空，自增，表示关系唯一标识符
- entity1_id：INT类型，外键引用Entity(id)，非空，表示关系涉及到的第一个实体标识符
- entity2_id: INT类型，外键引用Entity(id)，非空，表示关系涉及到的第二个实体标识符
- relation_type: VARCHAR(50) 类型, 非空, 表示关系类型

### 3.4 事件表（Event）

事件表存储时空对象发生的事件信息，包括以下字段：

- id: INT类型，主键，非空，自增，表示事件唯一标识符
- entity_id: INT类型, 外键引用Entity(id), 非空, 表示事件涉及到的实体标识符
- event_type: VARCHAR(50) 类型, 非空, 表示事件类型
- event_time: DATETIME 类型, 非空, 表示事件发生时间

## 4. 数据库安全设计

本部分给出了智慧城市空间信息服务平台时空数据建库规范所涉及到的用户角色和权限设置，并对各个用户可以访问和操作哪些数据进行了说明。

### 4.1 用户角色

本文档定义了以下四种用户角色：

- 管理员（admin）：负责数据库的创建、维护、备份、恢复等工作。
- 数据提供者（provider）：负责向数据库中导入、更新、删除时空数据。
- 数据使用者（user）：负责从数据库中查询、分析、展示时空数据。
- 数据审核者（auditor）：负责对数据库中的时空数据进行质量检查和评价。

### 4.2 用户权限

本文档规定了以下用户权限：

| 用户角色   | 元数据表 | 实体表 | 关系表 | 事件表 |
| ---------- | -------- | ------ | ------ | ------ |
| 管理员     | CRUD     | CRUD   | CRUD   | CRUD   |
| 数据提供者 | CRU      | CRU    | CRU    | CRU    |
| 数据使用者 | R        | R      | R      | R      |
| 数据审核者 | RU       | RU     | RU     | RU     |

注：CRUD表示创建（Create）、读取（Read）、更新（Update）、删除（Delete）操作。

## 5. 数据库测试设计

本部分给出了智慧城市空间信息服务平台时空数据建库规范所涉及到的测试用例和测试结果，并对数据库是否满足需求和性能指标进行了说明。

### 5.1 测试用例

本文档设计了以下几种测试用例：

- 数据库连接测试：测试数据库是否能够正常连接和断开。
- 数据库操作测试：测试数据库是否能够支持各种数据操作，如增删改查等。
- 数据库安全测试：测试数据库是否能够实现用户角色和权限控制，防止非法访问和操作。
- 数据库性能测试：测试数据库是否能够满足时效性、并发性、可扩展性等性能要求。

### 5.2 测试结果

本文档记录了以下几种测试结果：

- 数据库连接测试结果：通过，数据库可以正常连接和断开。
- 数据库操作测试结果：通过，数据库可以支持各种数据操作，且无错误或异常发生。
- 数据库安全测试结果：通过，数据库可以实现用户角色和权限控制，防止非法访问和操作。
- 数据库性能测试结果：通过，数据库可以满足时效性、并发性、可扩展性等性能要求。
